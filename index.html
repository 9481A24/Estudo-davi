<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Caderno Digital â€” Login</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f3f6fb; }
  .wrap { max-width:800px; margin:40px auto; padding:20px; }
  .card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.08); }
  h1 { margin-top:0; }
  label { display:block; margin-top:10px; font-weight:600; }
  input { width:100%; padding:10px; margin-top:5px; border-radius:8px; border:1px solid #ccc; }
  button { margin-top:15px; padding:10px 14px; border:none; border-radius:10px; background:#2b8ed6; color:#fff; cursor:pointer; }
  .smallbtn { background:transparent; border:1px solid #ccc; color:#333; padding:8px 12px; margin-top:10px; cursor:pointer; }
  .hidden { display:none; }
  .list { margin-top:20px; max-height:400px; overflow:auto; }
  .item { padding:12px; background:#fefefe; border:1px solid #eee; border-radius:8px; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center; }
</style>
</head>
<body>
<div class="wrap">
  <!-- LOGIN -->
  <div id="loginCard" class="card">
    <h1>ðŸ“– Caderno Digital</h1>
    <label>UsuÃ¡rio</label>
    <input type="text" id="user" placeholder="Digite seu usuÃ¡rio">
    <label>Senha</label>
    <input type="password" id="pass" placeholder="Digite sua senha">
    <button id="btnLogin">Entrar</button>
    <button id="btnRegister" class="smallbtn">Criar Conta</button>
    <p style="margin-top:10px; font-size:13px; color:#666;">As contas ficam salvas apenas no navegador.</p>
  </div>

  <!-- PAINEL -->
  <div id="appCard" class="card hidden">
    <h1>ðŸ“š Meus Textos</h1>
    <label>ConteÃºdo do texto:</label>
    <textarea id="newContent" rows="6" style="width:100%; padding:10px; border-radius:8px; border:1px solid #ccc;"></textarea>
    <button id="btnCreate">Salvar e Abrir</button>

    <div class="list" id="list"></div>
    <button id="btnLogout" style="margin-top:10px;background:#ff5a5f;">Sair</button>
  </div>
</div>

<script>
let users = JSON.parse(localStorage.getItem('cd_users')||'{}');
let currentUser = sessionStorage.getItem('cd_user') || null;

const loginCard = document.getElementById('loginCard');
const appCard = document.getElementById('appCard');
const userInput = document.getElementById('user');
const passInput = document.getElementById('pass');
const btnLogin = document.getElementById('btnLogin');
const btnRegister = document.getElementById('btnRegister');
const btnLogout = document.getElementById('btnLogout');
const newContent = document.getElementById('newContent');
const btnCreate = document.getElementById('btnCreate');
const listDiv = document.getElementById('list');

function showApp() { loginCard.classList.add('hidden'); appCard.classList.remove('hidden'); loadTexts(); }
function showLogin() { loginCard.classList.remove('hidden'); appCard.classList.add('hidden'); }

if(currentUser) showApp();

btnRegister.addEventListener('click', ()=>{
  const u = userInput.value.trim(); const p = passInput.value;
  if(!u||!p) return alert('Preencha usuÃ¡rio e senha');
  if(users[u]) return alert('UsuÃ¡rio jÃ¡ existe');
  users[u] = p;
  localStorage.setItem('cd_users', JSON.stringify(users));
  alert('Conta criada! FaÃ§a login.');
});

btnLogin.addEventListener('click', ()=>{
  const u = userInput.value.trim(); const p = passInput.value;
  if(users[u] && users[u]===p){
    currentUser = u;
    sessionStorage.setItem('cd_user', u);
    showApp();
  } else alert('UsuÃ¡rio ou senha incorretos');
});

btnLogout.addEventListener('click', ()=>{
  sessionStorage.removeItem('cd_user'); currentUser=null; showLogin();
});

function saveText(content){
  let texts = JSON.parse(localStorage.getItem('cd_texts')||'[]');
  const id = Date.now();
  texts.push({ id, user:currentUser, content, createdAt:new Date().toISOString() });
  localStorage.setItem('cd_texts', JSON.stringify(texts));
  return id;
}

function loadTexts(){
  listDiv.innerHTML='';
  let texts = JSON.parse(localStorage.getItem('cd_texts')||'[]');
  texts = texts.filter(t=>t.user===currentUser).sort((a,b)=>b.id-a.id);
  texts.forEach(t=>{
    const div = document.createElement('div'); 
    div.className='item';
    
    // Exibir primeiras palavras + data
    const preview = t.content.length > 30 ? t.content.slice(0,30)+'...' : t.content;
    const date = new Date(t.createdAt).toLocaleString('pt-BR');
    div.innerHTML = `<strong>${preview}</strong> <span style="font-size:12px;color:#888;">${date}</span>`;
    
    div.addEventListener('click', ()=> {
      window.open('texto.html?id='+t.id,'_blank');
    });
    listDiv.appendChild(div);
  });
}

btnCreate.addEventListener('click', ()=>{
  if(!newContent.value.trim()) return alert('Digite o conteÃºdo do texto');
  saveText(newContent.value.trim());
  newContent.value='';
  loadTexts();
});
</script>
</body>
</html>

